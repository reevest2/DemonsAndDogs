@using Models.Character
@using System.Text.Json.Nodes
@using Microsoft.AspNetCore.Components.Forms

<div class="mb-4 p-3 border rounded">
    <div class="row mb-2">
        <div class="col">
            <label class="form-label">Section Title</label>
            <InputText class="form-control" @bind-Value="Section.Title" />
        </div>
        <div class="col">
            <label class="form-label">Section Key</label>
            <InputText class="form-control" @bind-Value="Section.Key" />
        </div>
        <div class="col-auto d-flex align-items-end">
            <button type="button" class="btn btn-danger" @onclick="DeleteSection">Remove Section</button>
        </div>
    </div>
    <h5>Fields</h5>
    @foreach (var field in Section.Fields)
    {
        <FieldEditor Field="field" OnRemove="RemoveField" />
    }
    <button type="button" class="btn btn-outline-primary mt-2" @onclick="AddField">Add Field</button>
</div>

@code {
    /// <summary>
    /// Gets or sets the character sheet section being edited.
    /// </summary>
    [Parameter] public CharacterSheetSection Section { get; set; }
    /// <summary>
    /// Callback raised when a section is removed.
    /// </summary>
    [Parameter] public EventCallback<CharacterSheetSection> OnRemove { get; set; }

    private async Task DeleteSection()
    {
        await OnRemove.InvokeAsync(Section);
    }

    private void AddField()
    {
        Section.Fields.Add(new CharacterSheetField
        {
            Type = "text",
            Value = JsonValue.Create<string?>(null)
        });
    }

    private async Task RemoveField(CharacterSheetField field)
    {
        Section.Fields.Remove(field);
        await Task.CompletedTask;
    }
}