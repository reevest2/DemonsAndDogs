@using Microsoft.Win32
@using Radzen.Blazor
@using UIComponents.ResourceRegistry

<RadzenTabs>
    <Tabs>
    <RadzenTabsItem Text="Editor">
        <DynamicComponent Type="@editorComponentType" Parameters="editorParameters"/>
    </RadzenTabsItem>

    <RadzenTabsItem Text="Resources">
        <DynamicComponent Type="@gridComponentType" Parameters="gridParameters"/>
    </RadzenTabsItem>
    </Tabs>
</RadzenTabs>

@code {
    [Parameter] public string ResourceName { get; set; }
    [Parameter] public EventCallback<object> OnSave { get; set; }
    [Parameter] public object Items { get; set; }
    [Inject] public IResourceManagerRegistry Registry { get; set; }

    private Type editorComponentType;
    private Type gridComponentType;

    private IDictionary<string, object> editorParameters = new Dictionary<string, object>();
    private IDictionary<string, object> gridParameters = new Dictionary<string, object>();

    protected override void OnParametersSet()
    {
        if (Registry != null && Registry.TryGet(ResourceName, out var config))
        {
            editorComponentType = config.Editor;
            gridComponentType = config.Grid;

            editorParameters = new Dictionary<string, object>
            {
                ["Model"] = config.CreateModel.Invoke(),
                ["OnSave"] = OnSave
            };

            
            gridParameters = new Dictionary<string, object>
            {
                ["Items"] = Items
            };
        }
        else
        {
            editorComponentType = null; //typeof(JsonResourceEditor);
            gridComponentType = null; //typeof(ResourceGrid<>);
            editorParameters = new Dictionary<string, object>();
            gridParameters = new Dictionary<string, object>();
        }
    }
}