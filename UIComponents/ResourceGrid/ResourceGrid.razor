@typeparam TResource
@using System.Text.Json
@using Models.Resources
@using Models.Resources.Abstract
@using Radzen
@using Radzen.Blazor

<RadzenDataGrid TItem="TResource" Data="@Items" ColumnWidth="200px">
    <Columns>
        <RadzenDataGridColumn TItem="TResource" Property="OwnerId"  Title="OwnerId" Width="160px"/>
        <RadzenDataGridColumn TItem="TResource" Property="Version" Title="Ver" Width="80px" />
        <RadzenDataGridColumn TItem="TResource" Property="CreatedAt" Title="Created" FormatString="{0:G}" Width="180px" />
        <RadzenDataGridColumn TItem="TResource" Property="UpdatedAt" Title="Updated" FormatString="{0:G}" Width="180px" />
        <RadzenDataGridColumn TItem="TResource" Property="IsDeleted" Title="Deleted" Width="90px" />

        <RadzenDataGridColumn TItem="TResource" Title="Actions" Width="260px">
            <Template Context="row">
                <RadzenStack Orientation="Orientation.Horizontal" Gap="8px">
                    <RadzenButton Text="View"
                                  Icon="visibility"
                                  Size="ButtonSize.Small"
                                  ButtonStyle="ButtonStyle.Light"
                                  Click="@(() => ViewJson(row))" />
                </RadzenStack>
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

@code {
    [Parameter] public IEnumerable<TResource> Items { get; set; } = [];
    [Inject] DialogService DialogService { get; set; }

    async Task ViewJson(TResource row)
    {
        var json = JsonSerializer.Serialize(row, new JsonSerializerOptions { WriteIndented = true });
        await DialogService.OpenAsync<JsonViewerDialog>(
            "Resource JSON",
            new Dictionary<string, object> { ["Json"] = json },
            new DialogOptions { Width = "900px", Height = "650px", Resizable = true, Draggable = true }
        );
    }
    
}