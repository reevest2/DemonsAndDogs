@page "/Schemas/Create"
@using Models.Resources
@using MediatR
@using Mediator.Mediator.Contracts
@using Radzen
@using Radzen.Blazor
@inject IMediator Mediator
@inject NavigationManager NavManager
@inject NotificationService NotificationService

<RadzenContent Container="main">
    <RadzenCard Style="max-width: 600px; margin: 40px auto">
        <RadzenText Text="Create New Schema" TextStyle="TextStyle.H4" Style="margin-bottom: 20px" />
        <RadzenStack Gap="15px">
            <RadzenStack Gap="5px">
                <RadzenLabel Text="Schema Key (Unique Identifier)" />
                <RadzenTextBox @bind-Value="schemaKey" Placeholder="e.g. monster-schema" />
            </RadzenStack>
            <RadzenStack Gap="5px">
                <RadzenLabel Text="Name" />
                <RadzenTextBox @bind-Value="name" Placeholder="e.g. Monster Schema" />
            </RadzenStack>
            <RadzenButton Text="Create" Click="@CreateSchema" />
        </RadzenStack>
    </RadzenCard>
</RadzenContent>

@code {
    private string schemaKey = "";
    private string name = "";
    private string ownerId = "DefaultUser";

    private async Task CreateSchema()
    {
        if (string.IsNullOrWhiteSpace(schemaKey) || string.IsNullOrWhiteSpace(name))
        {
            NotificationService.Notify(new NotificationMessage { Severity = NotificationSeverity.Warning, Summary = "Required", Detail = "Both Key and Name are required." });
            return;
        }

        try
        {
            var schema = await Mediator.Send(new CreateSchemaCommand(ownerId, schemaKey, name));
            NotificationService.Notify(new NotificationMessage { Severity = NotificationSeverity.Success, Summary = "Created", Detail = "Schema created successfully" });
            NavManager.NavigateTo($"/Schemas/{schema.SchemaKey}");
        }
        catch (Exception ex)
        {
            NotificationService.Notify(new NotificationMessage { Severity = NotificationSeverity.Error, Summary = "Error", Detail = ex.Message });
        }
    }
}
